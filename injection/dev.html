<html>

<head>
  <link rel="stylesheet" type="text/css" href="css/website-detection.css">
</head>

<body>
  <div id="website-detection">

    <!--injection-html-->
    <style>/*<jdists import="css/website-detection.css" />*/</style>
    <div class="panel_header">
      <a href="https://weibo.com/zswang" target="_blank" class="image_logo">z</a>
      <span class="label_title">Website Detection</span>
      <span class="btn_close">×</span>
    </div>
    <div class="panel_content">
      <ul class="features"></ul>
    </div>
    <!--/injection-html-->

  </div>
</body>
<script>
  (function () {
    if (!window.performance || !performance.getEntries) {
      return;
    }

    var features = [
      {
        pattern: /www\.google-analytics\.com\/analytics\.js|ssl\.google-analytics\.com\/ga\.js/,
        name: 'google-analytics',
        title: '谷歌分析',
        global: 'GoogleAnalyticsObject',
        home: 'https://analytics.google.com/',
      },

      {
        pattern: /www\.googletagmanager\.com\/gtm\.js/,
        name: 'google-tagmanager',
        title: 'tag manager',
        global: 'google_tag_manager',
        home: 'https://www.google.com/analytics/tag-manager/',
      },

      {
        pattern: /hm\.baidu\.com\/hm\.js|hm\.baidu\.com\/h\.js|datax\.baidu\.com\/x\.js/,
        name: 'baidutongji',
        title: '百度统计',
        global: '_hmt',
        home: 'http://tongji.baidu.com/',
      },
      {
        pattern: /www\.sensorsdata\.cn\/sdk\/sensorsdata\.www\.js|sensorsdata\.min\.js/,
        name: 'sensorsdata',
        title: '神策数据',
        global: 'sensorsDataAnalytic201505',
        home: 'http://sensorsdata.cn/',
      },
      {
        pattern: /js\.ptengine\.cn\/\w+\.js/,
        name: 'ptengine',
        title: '铂金分析',
        global: 'badgeSign',
        home: 'http://www.ptengine.cn/',
      },
      {
        pattern: /dn-growing\.qbox\.me\/vds-gate\.js|dn-growing\.qbox\.me\/vds\.js/,
        name: 'growingio',
        title: 'GrowingIO',
        global: 'grcs',
        home: 'https://www.growingio.com/',
      },
      {
        pattern: /zhugeio\.com\/common\/js\/track[\w.]+\.js/,
        name: 'zhugeio',
        title: '诸葛io',
        global: 'zhuge',
        home: 'https://zhugeio.com/',
      },
      {
        pattern: /w\.cnzz\.com\/c\.php\?id=\w+/,
        name: 'cnzz',
        title: 'CNZZ/友盟',
        global: 'cnzz',
        home: 'http://www.umeng.com/',
      },
      {
        pattern: /static\.t\.agrantsem\.com\/ag_track[\w-.]+\.js/,
        name: 'agrantsem',
        title: 'AnG',
        global: '_agtjs',
        home: 'http://www.agrantsem.com/',
      },
      {
        pattern: /tajs\.qq\.com\/stats\?sId=\w+/,
        name: 'tencent-analytics',
        title: '腾讯分析',
        global: 'taClick',
        home: 'http://v2.ta.qq.com/',
      },

      {
        pattern: /b\.scorecardresearch\.com\/beacon\.js/,
        name: 'scorecard-research',
        title: 'ScorecardResearch',
        global: 'udm_',
        home: 'http://www.scorecardresearch.com/',
      },
    ];

    /*<debug>*/
    window._hmt = true;
    window.taClick = true;
    /*/<debug>*/

    var currentFeatures = [];
    performance.getEntries().forEach(function (entrie) {
      features.forEach(function (feature) {
        if (feature.pattern.test(entrie.name)) {
          if (currentFeatures.indexOf(feature) < 0) {
            currentFeatures.push(feature)
          }
        }
      })
    });

    features.forEach(function (feature) {
      if (feature.global in window) {
        if (currentFeatures.indexOf(feature) < 0) {
          currentFeatures.push(feature);
        }
      }
    });

    var websiteDetection = document.querySelector('#website-detection');
    var elementFeatures = websiteDetection.querySelector('.features');

    var html = '';
    currentFeatures.forEach(function (feature) {
      html += `
  <li>
    <h4>${feature.title}</h4>
    <a href="${feature.home}" target="_blank"><img src="${'https://raw.githubusercontent.com/zswang/website-detection/master/public/img/' + feature.name + '.png'}" alt="${feature.name}"></a>
  </li>`;
    });

    elementFeatures.innerHTML = html;
  })();

</script>

</html>